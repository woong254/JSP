<!DOCTYPE html>
<html>
<head>
<meta charset='utf-8' />
<script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', async function () {
	   
      // 값을 담을 변수 선언.
      let eventList = [{
        title: "test",
        start: "2025-08-04"
      }];
      
      // ajax 실행.
      try {
        let resolve = await fetch('eventList.do');
        let result = await resolve.json();
	    eventList = result.map(e => ({
				  title: e.title,
			 	  start: e.startDate,
			 	  end: e.endDate
		}));
        // console.log(eventList);
      } catch (err) {
        console.log(err)
      }

      var calendarEl = document.getElementById('calendar');
      var calendar = new FullCalendar.Calendar(calendarEl, {
        headerToolbar: {
          left: 'prev,next today',
          center: 'title',
          right: 'dayGridMonth,timeGridWeek,timeGridDay'
        },
        initialDate: new Date(), //'2025-01-12',
        navLinks: true, // can click day/week names to navigate views
        selectable: true,
        selectMirror: true,
        select: async function (arg) {
          var title = prompt('일정을 등록하세요!');
          if (title) {
            try {
              let resolve = await fetch('addEvent.do?title=' + title + '&start=' + arg.startStr + '&end=' +
                arg.endStr)
              let result = await resolve.json();
              if (result.retCode == 'OK') {
                // 캘린더에 일정을 추가.  
                calendar.addEvent({
                  title: title,
                  start: arg.start,
                  end: arg.end,
                  allDay: arg.allDay
                }) // 일정추가.
              } else if (result.retCode == 'NG') {
                alert('에러가 발생.');
              } else {
                alert('알수 없는 예외.');
              }
            } catch (err) {
              alert('처리중 에러');
              console.error(err);
            }
          } // end of if.
          calendar.unselect()
        },
        eventClick: function (arg) {
          if (confirm('Are you sure you want to delete this event?')) {
            fetch('removeEvent.do?title=' + arg.event.title)
              .then(resolve => resolve.json())
              .then(result => {
                if (result.retCode == 'OK')
                  arg.event.remove();
                else if (result.retCode == 'NG')
                  alert('삭제 실패');
                else
                  alert('알수없는 에러코드');
              })
              .catch(err => console.error(err))
          }
        },
        editable: true,
        dayMaxEvents: true, // allow "more" link when too many events
        events: eventList
      });
      calendar.render();

    }); // end of DOMContentLoaded.
  </script>
  <style>
    body {
      margin: 40px 10px;
      padding: 0;
      font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
      font-size: 14px;
    }

    #calendar {
      max-width: 1100px;
      margin: 0 auto;
    }
  </style>
</head>

<body>

  <div id='calendar'></div>

</body>

</html>